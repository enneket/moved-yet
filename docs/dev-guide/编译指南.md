# Moved Yet - ç¼–è¯‘æŒ‡å—

> ğŸ“¦ ä»æºç ç¼–è¯‘ VS Code æ‰©å±•åŒ…çš„å®Œæ•´æŒ‡å—

---

## ğŸ¯ ç¼–è¯‘æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ ä»æºç ç¼–è¯‘å‡ºå¯å®‰è£…çš„ `.vsix` æ‰©å±•åŒ…ã€‚æ— è®ºä½ æ˜¯æƒ³è¦ï¼š
- ğŸ”§ è‡ªå®šä¹‰åŠŸèƒ½åé‡æ–°æ‰“åŒ…
- ğŸ§ª æµ‹è¯•æœ€æ–°çš„å¼€å‘ç‰ˆæœ¬
- ğŸ“¦ ä¸ºä¸åŒç¯å¢ƒåˆ›å»ºå®šåˆ¶ç‰ˆæœ¬
- ğŸš€ å­¦ä¹  VS Code æ‰©å±•çš„æ‰“åŒ…æµç¨‹

éƒ½å¯ä»¥é€šè¿‡æœ¬æŒ‡å—å®Œæˆç¼–è¯‘ã€‚

---

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

### å¿…éœ€ç¯å¢ƒ
- **Node.js**: 16.x æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ¨è 18.x+ï¼‰
- **npm** æˆ– **pnpm**: æœ€æ–°ç‰ˆæœ¬
- **Git**: ç”¨äºå…‹éš†é¡¹ç›®
- **VS Code**: 1.100.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆç”¨äºæµ‹è¯•ï¼‰

### å¯é€‰å·¥å…·
- **Docker**: ç”¨äºå®¹å™¨åŒ–ç¼–è¯‘
- **@vscode/vsce**: VS Code æ‰©å±•æ‰“åŒ…å·¥å…·

### ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version
# åº”æ˜¾ç¤º v16.x.x æˆ–æ›´é«˜

# æ£€æŸ¥ npm ç‰ˆæœ¬
npm --version
# åº”æ˜¾ç¤º 8.x.x æˆ–æ›´é«˜

# æ£€æŸ¥ Git ç‰ˆæœ¬
git --version
# åº”æ˜¾ç¤º git version 2.x.x æˆ–æ›´é«˜
```

---

## ğŸ“‹ ç¼–è¯‘æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè·å–æºç 

```bash
# å…‹éš†é¡¹ç›®ï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ä»“åº“åœ°å€ï¼‰
git clone https://github.com/your-repo/moved-yet.git
cd moved-yet

# æŸ¥çœ‹é¡¹ç›®ç»“æ„
ls -la
```

### ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ npm
npm install

# æˆ–ä½¿ç”¨ pnpmï¼ˆæ¨èï¼Œæ›´å¿«ï¼‰
pnpm install

# éªŒè¯å®‰è£…
ls node_modules
```

### ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘ TypeScript

```bash
# å•æ¬¡ç¼–è¯‘
npm run compile

# æˆ–ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
npm run watch

# éªŒè¯ç¼–è¯‘ç»“æœ
ls out/
```

### ç¬¬å››æ­¥ï¼šè¿è¡Œæµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œä»£ç æ£€æŸ¥
npm run lint

# ä¿®å¤ä»£ç æ ¼å¼é—®é¢˜
npm run lint -- --fix
```

### ç¬¬äº”æ­¥ï¼šæ‰“åŒ…æ‰©å±•

é€‰æ‹©ä»¥ä¸‹ä»»ä¸€æ–¹æ³•ï¼š

#### æ–¹æ³• Aï¼šä½¿ç”¨ vsceï¼ˆæ¨èï¼‰
```bash
# å…¨å±€å®‰è£… vsce
npm install -g @vscode/vsce

# æ‰“åŒ…
vsce package

# æˆ–ä½¿ç”¨ npxï¼ˆæ— éœ€å…¨å±€å®‰è£…ï¼‰
npx @vscode/vsce package
```

#### æ–¹æ³• Bï¼šä½¿ç”¨é¡¹ç›®è„šæœ¬
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x package-vsix.sh

# è¿è¡Œæ‰“åŒ…è„šæœ¬
./package-vsix.sh
```

#### æ–¹æ³• Cï¼šä½¿ç”¨ Docker
```bash
# åˆ›å»º Docker ç¼–è¯‘ç¯å¢ƒ
docker run --rm -v $(pwd):/workspace -w /workspace node:18 bash -c "
  npm install &&
  npm run compile &&
  npm install -g @vscode/vsce &&
  vsce package
"
```

### ç¬¬å…­æ­¥ï¼šéªŒè¯æ‰“åŒ…ç»“æœ

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
ls -la *.vsix

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼šmoved-yet-0.0.1.vsix

# æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé€šå¸¸åœ¨ 100KB - 2MB ä¹‹é—´ï¼‰
du -h *.vsix
```

---

## ğŸ”§ ç¼–è¯‘é…ç½®è¯¦è§£

### package.json å…³é”®å­—æ®µ

```json
{
  "name": "moved-yet",                    // æ‰©å±•åç§°
  "displayName": "Moved Yet",             // æ˜¾ç¤ºåç§°
  "version": "0.0.1",                     // ç‰ˆæœ¬å·
  "publisher": "Immerse",                 // å‘å¸ƒè€…
  "engines": {
    "vscode": "^1.100.0"                  // VS Code æœ€ä½ç‰ˆæœ¬
  },
  "main": "./out/extension.js",           // å…¥å£æ–‡ä»¶
  "scripts": {
    "vscode:prepublish": "pnpm run compile",  // å‘å¸ƒå‰è„šæœ¬
    "compile": "tsc -p ./",               // ç¼–è¯‘è„šæœ¬
    "package": "vsce package"             // æ‰“åŒ…è„šæœ¬
  }
}
```

### TypeScript é…ç½® (tsconfig.json)

```json
{
  "compilerOptions": {
    "module": "Node16",                   // æ¨¡å—ç³»ç»Ÿ
    "target": "ES2022",                   // ç¼–è¯‘ç›®æ ‡
    "outDir": "out",                      // è¾“å‡ºç›®å½•
    "lib": ["ES2022", "DOM"],             // åº“æ–‡ä»¶
    "sourceMap": true,                    // ç”Ÿæˆæºç æ˜ å°„
    "rootDir": "src",                     // æºç ç›®å½•
    "strict": true                        // ä¸¥æ ¼æ¨¡å¼
  },
  "exclude": [
    "node_modules",                       // æ’é™¤ä¾èµ–
    ".vscode-test"                        // æ’é™¤æµ‹è¯•æ–‡ä»¶
  ]
}
```

### æ‰“åŒ…æ’é™¤é…ç½® (.vscodeignore)

```
# å¼€å‘æ–‡ä»¶
.vscode/**
.vscode-test/**
src/**
**/tsconfig.json
**/eslint.config.mjs

# æºç æ–‡ä»¶
**/*.ts
**/*.map

# å…¶ä»–æ–‡ä»¶
.gitignore
.yarnrc
vsc-extension-quickstart.md
**/.vscode-test.*
```

---

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1ï¼šNode.js ç‰ˆæœ¬è¿‡ä½

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ReferenceError: File is not defined
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å‡çº§ Node.js åˆ° 16.x æˆ–æ›´é«˜
# ä½¿ç”¨ nvmï¼ˆæ¨èï¼‰
nvm install 18
nvm use 18

# æˆ–ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
# https://nodejs.org/
```

### é—®é¢˜ 2ï¼švsce å‘½ä»¤æœªæ‰¾åˆ°

**é”™è¯¯ä¿¡æ¯**ï¼š
```
bash: vsce: command not found
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ 1ï¼šå…¨å±€å®‰è£…
npm install -g @vscode/vsce

# æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ npx
npx @vscode/vsce package

# æ–¹æ¡ˆ 3ï¼šä½¿ç”¨é¡¹ç›®è„šæœ¬
./package-vsix.sh
```

### é—®é¢˜ 3ï¼šTypeScript ç¼–è¯‘é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
error TS2304: Cannot find name 'xxx'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç±»å‹å®šä¹‰
npm ls @types/vscode

# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# æ£€æŸ¥ TypeScript é…ç½®
npx tsc --noEmit
```

### é—®é¢˜ 4ï¼šæ‰“åŒ…æ–‡ä»¶è¿‡å¤§

**ç°è±¡**ï¼šç”Ÿæˆçš„ .vsix æ–‡ä»¶è¶…è¿‡ 10MB

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ .vscodeignore æ–‡ä»¶
cat .vscodeignore

# ç¡®ä¿æ’é™¤äº†ï¼š
# - node_modulesï¼ˆå¼€å‘ä¾èµ–ï¼‰
# - src/ï¼ˆæºç æ–‡ä»¶ï¼‰
# - æµ‹è¯•æ–‡ä»¶
# - æ–‡æ¡£æ–‡ä»¶

# é‡æ–°æ‰“åŒ…
vsce package
```

### é—®é¢˜ 5ï¼šæƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Permission denied: ./package-vsix.sh
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x package-vsix.sh

# æˆ–ç›´æ¥ç”¨ bash æ‰§è¡Œ
bash package-vsix.sh
```

---

## ğŸ¯ é«˜çº§ç¼–è¯‘æŠ€å·§

### 1. æ¡ä»¶ç¼–è¯‘

æ ¹æ®ä¸åŒç¯å¢ƒç¼–è¯‘ä¸åŒç‰ˆæœ¬ï¼š

```bash
# å¼€å‘ç‰ˆæœ¬
NODE_ENV=development npm run compile
vsce package --out moved-yet-dev.vsix

# ç”Ÿäº§ç‰ˆæœ¬
NODE_ENV=production npm run compile
vsce package --out moved-yet-prod.vsix
```

### 2. ç‰ˆæœ¬è‡ªåŠ¨åŒ–

```bash
# è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·å¹¶æ‰“åŒ…
npm version patch  # 0.0.1 -> 0.0.2
vsce package

npm version minor  # 0.0.2 -> 0.1.0
vsce package

npm version major  # 0.1.0 -> 1.0.0
vsce package
```

### 3. æ‰¹é‡ç¼–è¯‘è„šæœ¬

åˆ›å»º `build-all.sh`ï¼š

```bash
#!/bin/bash
set -e

echo "ğŸš€ å¼€å§‹æ‰¹é‡ç¼–è¯‘..."

# æ¸…ç†æ—§æ–‡ä»¶
rm -f *.vsix
rm -rf out/

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install

# è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
npm test

# ç¼–è¯‘é¡¹ç›®
echo "ğŸ”¨ ç¼–è¯‘é¡¹ç›®..."
npm run compile

# æ‰“åŒ…æ‰©å±•
echo "ğŸ“¦ æ‰“åŒ…æ‰©å±•..."
vsce package

# åˆ›å»ºå¤‡ä»½
echo "ğŸ’¾ åˆ›å»ºå¤‡ä»½..."
cp *.vsix "backup/moved-yet-$(date +%Y%m%d-%H%M%S).vsix"

echo "âœ… ç¼–è¯‘å®Œæˆï¼"
ls -la *.vsix
```

### 4. Docker å¤šé˜¶æ®µæ„å»º

åˆ›å»º `Dockerfile`ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run compile
RUN npm install -g @vscode/vsce
RUN vsce package

# è¾“å‡ºé˜¶æ®µ
FROM scratch AS output
COPY --from=builder /app/*.vsix /
```

ä½¿ç”¨ï¼š
```bash
docker build --target output --output . .
```

---

## ğŸ“Š ç¼–è¯‘æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨ pnpm æ›¿ä»£ npm

```bash
# å®‰è£… pnpm
npm install -g pnpm

# ä½¿ç”¨ pnpm å®‰è£…ä¾èµ–ï¼ˆæ›´å¿«ï¼‰
pnpm install

# ç¼–è¯‘
pnpm run compile
```

### 2. å¯ç”¨ TypeScript å¢é‡ç¼–è¯‘

åœ¨ `tsconfig.json` ä¸­æ·»åŠ ï¼š

```json
{
  "compilerOptions": {
    "incremental": true,
    "tsBuildInfoFile": ".tsbuildinfo"
  }
}
```

### 3. å¹¶è¡Œç¼–è¯‘

```bash
# ä½¿ç”¨å¤šæ ¸ç¼–è¯‘
npm run compile -- --build --verbose

# æˆ–ä½¿ç”¨ tsc-watch è¿›è¡Œç›‘å¬ç¼–è¯‘
npm install --save-dev tsc-watch
```

---

## ğŸ” ç¼–è¯‘éªŒè¯

### 1. åŸºæœ¬éªŒè¯

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
test -f moved-yet-0.0.1.vsix && echo "âœ… VSIX æ–‡ä»¶å·²ç”Ÿæˆ" || echo "âŒ VSIX æ–‡ä»¶æœªæ‰¾åˆ°"

# æ£€æŸ¥æ–‡ä»¶å¤§å°
FILE_SIZE=$(stat -f%z moved-yet-0.0.1.vsix 2>/dev/null || stat -c%s moved-yet-0.0.1.vsix)
echo "ğŸ“ æ–‡ä»¶å¤§å°: $((FILE_SIZE / 1024)) KB"
```

### 2. å†…å®¹éªŒè¯

```bash
# è§£å‹æŸ¥çœ‹å†…å®¹ï¼ˆVSIX æœ¬è´¨ä¸Šæ˜¯ ZIP æ–‡ä»¶ï¼‰
unzip -l moved-yet-0.0.1.vsix

# æ£€æŸ¥å…³é”®æ–‡ä»¶
unzip -l moved-yet-0.0.1.vsix | grep -E "(package.json|extension.js|README.md)"
```

### 3. å®‰è£…æµ‹è¯•

```bash
# å®‰è£…åˆ° VS Code
code --install-extension moved-yet-0.0.1.vsix

# éªŒè¯å®‰è£…
code --list-extensions | grep moved-yet

# å¸è½½ï¼ˆæµ‹è¯•å®Œæˆåï¼‰
code --uninstall-extension Immerse.moved-yet
```

---

## ğŸš€ è‡ªåŠ¨åŒ–ç¼–è¯‘

### GitHub Actions é…ç½®

åˆ›å»º `.github/workflows/build.yml`ï¼š

```yaml
name: Build Extension

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  release:
    types: [ created ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [16, 18, 20]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run linter
      run: npm run lint
    
    - name: Run tests
      run: npm test
    
    - name: Compile TypeScript
      run: npm run compile
    
    - name: Package extension
      run: npx @vscode/vsce package
    
    - name: Upload VSIX artifact
      uses: actions/upload-artifact@v4
      with:
        name: vsix-${{ matrix.node-version }}
        path: '*.vsix'
        retention-days: 30
    
    - name: Release
      if: github.event_name == 'release'
      uses: softprops/action-gh-release@v1
      with:
        files: '*.vsix'
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### æœ¬åœ° Git Hooks

åˆ›å»º `.git/hooks/pre-commit`ï¼š

```bash
#!/bin/bash
# æäº¤å‰è‡ªåŠ¨ç¼–è¯‘å’Œæµ‹è¯•

echo "ğŸ” è¿è¡Œæäº¤å‰æ£€æŸ¥..."

# è¿è¡Œä»£ç æ£€æŸ¥
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ä»£ç æ£€æŸ¥å¤±è´¥"
  exit 1
fi

# è¿è¡Œæµ‹è¯•
npm test
if [ $? -ne 0 ]; then
  echo "âŒ æµ‹è¯•å¤±è´¥"
  exit 1
fi

# ç¼–è¯‘é¡¹ç›®
npm run compile
if [ $? -ne 0 ]; then
  echo "âŒ ç¼–è¯‘å¤±è´¥"
  exit 1
fi

echo "âœ… æäº¤å‰æ£€æŸ¥é€šè¿‡"
```

---

## ğŸ“š ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [VS Code æ‰©å±•å¼€å‘æŒ‡å—](https://code.visualstudio.com/api)
- [vsce å·¥å…·æ–‡æ¡£](https://github.com/microsoft/vscode-vsce)
- [TypeScript ç¼–è¯‘é€‰é¡¹](https://www.typescriptlang.org/tsconfig)

### ç¤¾åŒºèµ„æº
- [VS Code æ‰©å±•ç¤ºä¾‹](https://github.com/microsoft/vscode-extension-samples)
- [æ‰©å±•å¼€å‘æœ€ä½³å®è·µ](https://code.visualstudio.com/api/references/extension-guidelines)
- [å‘å¸ƒåˆ°å¸‚åœºæŒ‡å—](https://code.visualstudio.com/api/working-with-extensions/publishing-extension)

### å·¥å…·æ¨è
- [nvm](https://github.com/nvm-sh/nvm) - Node.js ç‰ˆæœ¬ç®¡ç†
- [pnpm](https://pnpm.io/) - å¿«é€Ÿçš„åŒ…ç®¡ç†å™¨
- [Docker](https://www.docker.com/) - å®¹å™¨åŒ–ç¼–è¯‘ç¯å¢ƒ

---

## ğŸ‰ ç¼–è¯‘å®Œæˆ

æ­å–œï¼ä½ å·²ç»æˆåŠŸç¼–è¯‘å‡ºäº† VS Code æ‰©å±•åŒ…ã€‚ç°åœ¨ä½ å¯ä»¥ï¼š

1. **å®‰è£…æµ‹è¯•**ï¼š`code --install-extension moved-yet-0.0.1.vsix`
2. **åˆ†äº«ç»™ä»–äºº**ï¼šå°† .vsix æ–‡ä»¶å‘é€ç»™å…¶ä»–ç”¨æˆ·
3. **å‘å¸ƒåˆ°å¸‚åœº**ï¼šä½¿ç”¨ `vsce publish` å‘å¸ƒåˆ°å®˜æ–¹å¸‚åœº
4. **æŒç»­æ”¹è¿›**ï¼šæ ¹æ®åé¦ˆç»§ç»­ä¼˜åŒ–åŠŸèƒ½

è®°ä½ï¼Œç¼–è¯‘åªæ˜¯å¼€å§‹ï¼ŒæŒç»­çš„ç»´æŠ¤å’Œæ”¹è¿›æ‰èƒ½è®©æ‰©å±•çœŸæ­£å‘æŒ¥ä»·å€¼ï¼

---

**ç¥ç¼–è¯‘é¡ºåˆ©ï¼** ğŸš€