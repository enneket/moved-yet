# Moved Yet 集成测试指南

## 🔗 集成测试概述

集成测试验证各个模块之间的协作是否正常，确保系统作为一个整体能够正确工作。

## 🧩 测试架构

### 系统组件图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   VS Code API   │◄──►│  Extension.ts   │◄──►│  Config Service │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
        ┌─────────────────────────────────────────────────────┐
        │                Timer Service                        │
        └─────────────────────────────────────────────────────┘
                              │
                              ▼
        ┌─────────────────────────────────────────────────────┐
        │            Activity Detection Service               │
        └─────────────────────────────────────────────────────┘
                              │
                              ▼
        ┌─────────────────────────────────────────────────────┐
        │  Progressive Reminder ◄──► History ◄──► Status     │
        └─────────────────────────────────────────────────────┘
                              │
                              ▼
        ┌─────────────────────────────────────────────────────┐
        │              UI Components                          │
        │  Reminder UI  │  Dashboard UI  │  Status Display   │
        └─────────────────────────────────────────────────────┘
```

## 🔄 集成测试场景

### 1. 配置-计时器集成测试

#### 1.1 配置变更触发计时器重置
**测试目标**: 验证配置变更时计时器正确重置

**测试步骤**:
```typescript
// 伪代码测试流程
describe('配置-计时器集成', () => {
  test('配置变更触发计时器重置', async () => {
    // 1. 启动计时器
    startTimers();
    await wait(30000); // 等待30秒
    
    // 2. 修改配置
    updateConfig({ sitReminderInterval: 120 });
    
    // 3. 验证计时器重置
    const status = getTimerStatus();
    expect(status.sitElapsed).toBeLessThan(5); // 应该重置
  });
});
```

**验证点**:
- [ ] 配置变更后计时器立即重置
- [ ] 新配置值生效
- [ ] 其他计时器不受影响

#### 1.2 多配置同时变更
**测试步骤**:
1. 同时修改多个配置项
2. 验证所有相关计时器都重置
3. 验证配置间的依赖关系

### 2. 活动检测-计时器集成测试

#### 2.1 活动检测触发计时器重置
**测试目标**: 验证活动检测与计时器的协作

**测试场景**:
```bash
# 手动集成测试步骤
1. 设置短间隔便于测试
   movedYet.sitReminderInterval: 2 (分钟)
   movedYet.inactivityResetTime: 1 (分钟)

2. 启动计时器，等待1分钟

3. 模拟各种活动:
   - 键盘输入
   - 鼠标点击  
   - 文件切换
   - 命令执行

4. 验证每种活动都能触发重置
```

**验证点**:
- [ ] 键盘活动触发重置
- [ ] 鼠标活动触发重置
- [ ] 编辑器活动触发重置
- [ ] 命令活动触发重置
- [ ] 重置消息正确显示

#### 2.2 活动检测禁用时的行为
**测试步骤**:
1. 禁用活动检测
2. 模拟长时间无活动
3. 进行活动操作
4. 验证计时器不会自动重置

### 3. 渐进式提醒集成测试

#### 3.1 三级提醒流程集成
**测试目标**: 验证渐进式提醒各级之间的协作

**测试配置**:
```json
{
  "movedYet.enableProgressiveReminder": true,
  "movedYet.sitReminderInterval": 1,
  "movedYet.progressiveReminderLevel1Duration": 0.5,
  "movedYet.progressiveReminderLevel2Duration": 0.5
}
```

**测试流程**:
1. **第一级 (1分钟后)**: 状态栏提醒
   - [ ] 状态栏显示提醒图标
   - [ ] 可以点击状态栏确认
   - [ ] 不影响正常工作

2. **第二级 (1.5分钟后)**: 通知提醒
   - [ ] 弹出通知消息
   - [ ] 有"确认"和"稍后提醒"按钮
   - [ ] 点击"稍后提醒"重新开始流程

3. **第三级 (2分钟后)**: 全屏提醒
   - [ ] 显示全屏模态窗口
   - [ ] 必须确认才能继续
   - [ ] 确认后重置计时器

#### 3.2 渐进式提醒中断测试
**测试场景**:
1. 在第一级提醒时确认
2. 在第二级提醒时选择"稍后提醒"
3. 在任意级别时修改配置
4. 验证流程正确处理中断

### 4. 历史记录集成测试

#### 4.1 提醒-历史记录集成
**测试目标**: 验证提醒确认后正确记录历史

**测试步骤**:
1. 触发久坐提醒并确认
2. 触发喝水提醒并确认
3. 查看历史记录
4. 验证记录的准确性

**验证点**:
- [ ] 确认的提醒被正确记录
- [ ] 时间戳准确
- [ ] 提醒类型正确
- [ ] 统计数据更新

#### 4.2 工作时长统计集成
**测试步骤**:
1. 长时间运行扩展
2. 定期检查工作时长统计
3. 验证时长计算准确性

### 5. UI组件集成测试

#### 5.1 仪表盘数据集成
**测试目标**: 验证仪表盘显示的数据与历史记录一致

**测试步骤**:
1. 完成多次提醒确认
2. 打开仪表盘
3. 对比仪表盘数据与历史记录
4. 验证图表渲染正确

**验证点**:
- [ ] 今日统计数据一致
- [ ] 本周统计数据一致
- [ ] 图表数据正确
- [ ] 刷新功能正常

#### 5.2 多语言UI集成
**测试步骤**:
1. 切换语言设置
2. 触发各种提醒
3. 查看所有UI界面
4. 验证语言切换的完整性

## 🔧 集成测试工具

### 自动化集成测试脚本

让我创建一个集成测试脚本：