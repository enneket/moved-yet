# 智能工作时长统计功能

## 📊 功能概述

新的智能工作时长统计系统基于用户活动状态进行精确计时，解决了传统"只要VS Code开着就计时"的问题。

## 🧠 智能计时逻辑

### 🟢 活跃状态计时
- **触发条件**: 检测到键盘输入、鼠标操作、编辑器切换等活动
- **计时行为**: 正常累计工作时长
- **状态显示**: "工作计时: 进行中"

### 🟡 非活跃状态暂停
- **触发条件**: 连续10分钟无任何活动
- **计时行为**: 自动暂停工作时长累计
- **状态显示**: "工作计时: 已暂停"
- **时间记录**: 准确记录暂停前的工作时长

### 🔄 智能恢复计时
- **触发条件**: 非活跃状态下检测到新的用户活动
- **计时行为**: 自动恢复工作时长累计
- **时间处理**: 不计算中间的非活跃时间
- **提示信息**: 显示恢复提示和非活跃时长

## ⚙️ 技术实现

### 🔍 活动检测
```typescript
// 监听的活动类型
- 文本编辑器变化（键盘输入）
- 编辑器选择变化（鼠标点击、键盘导航）
- 活动编辑器变化（切换文件）
- 命令执行（各种用户操作）
- 工作区文件夹变化
- 配置变化
```

### ⏱️ 时间计算
```typescript
// 活跃时间累计
sessionMinutes = (currentTime - sessionStartTime) / 60000

// 非活跃检测
inactiveTime = currentTime - lastActiveTime
if (inactiveTime > 10分钟) {
    暂停计时()
}

// 恢复计时
if (检测到活动 && 之前已暂停) {
    重新开始计时()
}
```

## 🎮 用户控制

### 📋 查看状态
```bash
命令: "动了么？: 显示提醒状态"
显示内容:
- 工作计时: 进行中/已暂停
- 本次会话时长 或 暂停时长
- 今日总工作时长
```

### 🎛️ 手动控制
```bash
# 手动暂停工作计时
命令: "动了么？: 暂停工作计时"

# 手动恢复工作计时  
命令: "动了么？: 恢复工作计时"
```

### 🔍 详细测试
```bash
命令: "动了么？: 测试活动检测"
显示内容:
- 活动检测启用状态
- 当前无活动时长
- 工作计时状态
- 今日工作时长
```

## 📈 数据展示

### 🏠 仪表盘显示
- **今日工作时长**: 只计算实际活跃时间
- **本周工作时长**: 7天内累计活跃时间
- **历史趋势图**: 显示每日实际工作时长

### 📊 统计精度
- **时间单位**: 分钟级精度
- **更新频率**: 每10分钟自动保存
- **实时状态**: 活动检测实时响应
- **数据持久化**: 自动保存到VS Code全局状态

## 🔧 配置选项

### 🎯 相关设置
```json
{
    // 启用活动检测（必须开启才能使用智能计时）
    "movedYet.enableActivityDetection": true,
    
    // 无活动重置提醒的时间（不影响工作计时的10分钟阈值）
    "movedYet.inactivityResetTime": 5
}
```

### ⚠️ 注意事项
- 工作计时的10分钟非活跃阈值是固定的，不受 `inactivityResetTime` 配置影响
- `inactivityResetTime` 只影响提醒计时器的重置，不影响工作时长统计
- 必须启用活动检测功能，智能工作计时才能正常工作

## 🆚 对比传统方式

| 特性 | 传统计时 | 智能计时 |
|------|---------|---------|
| **计时依据** | VS Code运行时间 | 用户实际活动 |
| **离开处理** | 继续计时 | 自动暂停 |
| **回来处理** | 无感知 | 自动恢复 |
| **时间精度** | 粗略估算 | 精确统计 |
| **用户控制** | 无 | 手动暂停/恢复 |
| **状态反馈** | 无 | 实时状态显示 |

## 🎯 使用场景

### 👨‍💻 日常开发
- 专注编码时正常计时
- 开会、休息时自动暂停
- 回到电脑时自动恢复

### 📊 时间管理
- 准确了解实际工作时长
- 区分在线时间和工作时间
- 优化工作效率

### 🏢 团队协作
- 真实的工作时长统计
- 更准确的工作量评估
- 合理的时间规划

## 🔮 未来优化

### 🎯 可能的改进
- 可配置的非活跃阈值（目前固定10分钟）
- 更多活动类型检测（终端使用、调试等）
- 项目级别的工作时长统计
- 工作时长目标设置和提醒

### 📈 数据分析
- 工作效率分析
- 活跃时间段统计
- 工作习惯洞察

---

**💡 提示**: 这个功能让工作时长统计更加智能和准确，真正反映你的实际工作投入！