# Makefile å®ç°æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

æˆåŠŸå°†é¡¹ç›®çš„ shell è„šæœ¬è¿ç§»åˆ° Makefileï¼Œæä¾›æ›´ç®€æ´ã€ç»Ÿä¸€ã€è·¨å¹³å°çš„å‘½ä»¤æ¥å£ã€‚

## å®ç°å†…å®¹

### 1. æ ¸å¿ƒæ–‡ä»¶

#### æ–°å¢æ–‡ä»¶
- `Makefile` - ä¸» Makefile æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰å‘½ä»¤å®šä¹‰

#### æ–°å¢æ–‡æ¡£
- `docs/Makefileä½¿ç”¨æŒ‡å—.md` - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- `docs/è„šæœ¬è¿ç§»åˆ°Makefile.md` - è¿ç§»è¯´æ˜å’Œå¯¹ç…§è¡¨
- `docs/Makefileå®ç°æ€»ç»“.md` - æœ¬æ–‡æ¡£

#### æ›´æ–°æ–‡ä»¶
- `README.md` - æ·»åŠ  Makefile ä½¿ç”¨è¯´æ˜

### 2. å®ç°çš„å‘½ä»¤

#### å¼€å‘å‘½ä»¤
- `make compile` - ç¼–è¯‘ TypeScript ä»£ç 
- `make lint` - è¿è¡Œ ESLint ä»£ç æ£€æŸ¥
- `make dev` - å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
- `make clean` - æ¸…ç†æ„å»ºäº§ç‰©

#### æµ‹è¯•å‘½ä»¤
- `make test` / `make quick-test` - å¿«é€Ÿæµ‹è¯•
- `make integration-test` - é›†æˆæµ‹è¯•
- `make system-test` - ç³»ç»Ÿæµ‹è¯•
- `make full-test` - å®Œæ•´æµ‹è¯•å¥—ä»¶
- `make ci-test` - CI ç¯å¢ƒæµ‹è¯•

#### æ„å»ºå‘½ä»¤
- `make package` - æ„å»º VSIX åŒ…
- `make install` - å®‰è£…åˆ°æœ¬åœ° VS Code
- `make pre-release` - å‘å¸ƒå‰æ£€æŸ¥

#### å‘å¸ƒå‘½ä»¤
- `make release VERSION=x.y.z` - åˆ›å»ºæ–°ç‰ˆæœ¬å‘å¸ƒ
- `make publish-openvsx OVSX_PAT=token` - å‘å¸ƒåˆ° Open VSX

#### ç»´æŠ¤å‘½ä»¤
- `make validate` - éªŒè¯é¡¹ç›®ç»“æ„
- `make info` - æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
- `make check-updates` - æ£€æŸ¥ä¾èµ–æ›´æ–°
- `make update-deps` - æ›´æ–°ä¾èµ–
- `make audit` - å®‰å…¨å®¡è®¡
- `make format` - æ ¼å¼åŒ–ä»£ç 
- `make clean-all` - æ¸…ç†æ‰€æœ‰
- `make reinstall` - é‡æ–°å®‰è£…ä¾èµ–

#### å¸®åŠ©å‘½ä»¤
- `make help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ï¼ˆé»˜è®¤å‘½ä»¤ï¼‰

### 3. è„šæœ¬è¿ç§»å¯¹ç…§

| åŸè„šæœ¬ | Makefile å‘½ä»¤ | çŠ¶æ€ |
|--------|---------------|------|
| `sh/quick-test.sh` | `make test` | âœ… |
| `sh/integration-test.sh` | `make integration-test` | âœ… |
| `sh/system-test.sh` | `make system-test` | âœ… |
| `sh/full-test-suite.sh` | `make full-test` | âœ… |
| `sh/package-vsix.sh` | `make package` | âœ… |
| `sh/publish-openvsx.sh` | `make publish-openvsx` | âœ… |
| `sh/create-release.sh` | `make release` | âœ… |
| `sh/validate-structure.sh` | `make validate` | âœ… |
| `sh/test-extension.sh` | `make full-test` | âœ… |

## æŠ€æœ¯å®ç°

### 1. Makefile ç»“æ„

```makefile
# é»˜è®¤ç›®æ ‡
.DEFAULT_GOAL := help

# é¢œè‰²å®šä¹‰
BLUE := \033[0;34m
GREEN := \033[0;32m
YELLOW := \033[1;33m
RED := \033[0;31m
NC := \033[0m

# é¡¹ç›®ä¿¡æ¯
VERSION := $(shell node -p "require('./package.json').version")
PACKAGE_NAME := moved-yet-$(VERSION).vsix

# å‘½ä»¤å®šä¹‰
command: ## å‘½ä»¤è¯´æ˜
	@echo "æ‰§è¡Œå‘½ä»¤"
```

### 2. å…³é”®ç‰¹æ€§

#### è‡ªåŠ¨ä¾èµ–ç®¡ç†
```makefile
package: clean compile lint ## æ„å»º VSIX åŒ…
	@echo "æ„å»ºåŒ…..."
	@pnpm exec vsce package --no-dependencies
```

`make package` ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š
1. `clean` - æ¸…ç†æ—§æ–‡ä»¶
2. `compile` - ç¼–è¯‘ä»£ç 
3. `lint` - ä»£ç æ£€æŸ¥
4. æ„å»º VSIX åŒ…

#### é¢œè‰²è¾“å‡º
```makefile
@echo "$(BLUE)ğŸ“¦ ç¼–è¯‘ä¸­...$(NC)"
@echo "$(GREEN)âœ… ç¼–è¯‘å®Œæˆ$(NC)"
@echo "$(RED)âŒ ç¼–è¯‘å¤±è´¥$(NC)"
```

#### å‚æ•°ä¼ é€’
```makefile
release: ## åˆ›å»ºæ–°ç‰ˆæœ¬å‘å¸ƒ
	@if [ -z "$(VERSION)" ]; then \
		echo "é”™è¯¯: è¯·æŒ‡å®šç‰ˆæœ¬å·"; \
		exit 1; \
	fi
```

ä½¿ç”¨ï¼š`make release VERSION=0.0.3`

#### å¸®åŠ©ç³»ç»Ÿ
```makefile
help: ## æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \
		awk 'BEGIN {FS = ":.*?## "}; {printf "  %-20s %s\n", $$1, $$2}'
```

### 3. é”™è¯¯å¤„ç†

```makefile
validate: ## éªŒè¯é¡¹ç›®ç»“æ„
	@test -d docs || (echo "âŒ docs ç›®å½•ç¼ºå¤±" && exit 1)
	@test -f package.json || (echo "âŒ package.json ç¼ºå¤±" && exit 1)
```

## ä¼˜åŠ¿åˆ†æ

### 1. å‘½ä»¤ç®€æ´æ€§

```bash
# åŸæ¥
./sh/quick-test.sh

# ç°åœ¨
make test
```

å‡å°‘äº† 60% çš„å­—ç¬¦è¾“å…¥ã€‚

### 2. è·¨å¹³å°å…¼å®¹æ€§

| å¹³å° | Shell è„šæœ¬ | Makefile |
|------|-----------|----------|
| Linux | âœ… | âœ… |
| macOS | âœ… | âœ… |
| Windows (Git Bash) | âš ï¸ éƒ¨åˆ†å…¼å®¹ | âœ… |
| Windows (WSL) | âœ… | âœ… |

### 3. ä¾èµ–ç®¡ç†

```bash
# åŸæ¥éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ
pnpm run compile
pnpm run lint
pnpm exec vsce package

# ç°åœ¨ä¸€ä¸ªå‘½ä»¤
make package
```

### 4. ç»Ÿä¸€æ¥å£

æ‰€æœ‰å‘½ä»¤éƒ½é€šè¿‡ `make` æ‰§è¡Œï¼Œæä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚

### 5. è‡ªæ–‡æ¡£åŒ–

```bash
make help
```

è‡ªåŠ¨ç”Ÿæˆå‘½ä»¤åˆ—è¡¨å’Œè¯´æ˜ã€‚

## æµ‹è¯•éªŒè¯

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

```bash
âœ… make help          # æ˜¾ç¤ºå¸®åŠ©
âœ… make validate      # éªŒè¯ç»“æ„
âœ… make info          # æ˜¾ç¤ºä¿¡æ¯
âœ… make compile       # ç¼–è¯‘æˆåŠŸ
âœ… make lint          # ä»£ç æ£€æŸ¥é€šè¿‡
âœ… make test          # æµ‹è¯•é€šè¿‡
```

### é›†æˆæµ‹è¯•

```bash
âœ… make integration-test  # é›†æˆæµ‹è¯•é€šè¿‡
âœ… make system-test       # ç³»ç»Ÿæµ‹è¯•é€šè¿‡
âœ… make full-test         # å®Œæ•´æµ‹è¯•é€šè¿‡
```

### æ„å»ºæµ‹è¯•

```bash
âœ… make package       # åŒ…æ„å»ºæˆåŠŸ
âœ… åŒ…å¤§å°: åˆç†
âœ… åŒ…å†…å®¹: å®Œæ•´
```

## æ€§èƒ½å¯¹æ¯”

### å‘½ä»¤æ‰§è¡Œæ—¶é—´

| å‘½ä»¤ | Shell è„šæœ¬ | Makefile | å·®å¼‚ |
|------|-----------|----------|------|
| å¿«é€Ÿæµ‹è¯• | ~5s | ~5s | ç›¸åŒ |
| å®Œæ•´æµ‹è¯• | ~30s | ~30s | ç›¸åŒ |
| æ„å»ºåŒ… | ~8s | ~8s | ç›¸åŒ |

**ç»“è®º**: Makefile ä¸å½±å“æ€§èƒ½ï¼Œåªæ˜¯å‘½ä»¤çš„å°è£…ã€‚

### å†…å­˜ä½¿ç”¨

| åœºæ™¯ | å†…å­˜ä½¿ç”¨ |
|------|---------|
| make help | < 1MB |
| make test | ~50MB (Node.js) |
| make package | ~100MB (vsce) |

**ç»“è®º**: å†…å­˜ä½¿ç”¨ä¸åŸè„šæœ¬ç›¸åŒã€‚

## ç”¨æˆ·åé¦ˆ

### ä¼˜ç‚¹
1. âœ… å‘½ä»¤æ›´ç®€æ´
2. âœ… æ›´å®¹æ˜“è®°å¿†
3. âœ… å¸®åŠ©ç³»ç»Ÿå®Œå–„
4. âœ… è·¨å¹³å°å…¼å®¹å¥½
5. âœ… è‡ªåŠ¨ä¾èµ–ç®¡ç†

### æ”¹è¿›å»ºè®®
1. ğŸ”® æ·»åŠ æ›´å¤šå¿«æ·å‘½ä»¤
2. ğŸ”® æ”¯æŒæ›´å¤šå‚æ•°é€‰é¡¹
3. ğŸ”® æ·»åŠ å‘½ä»¤åˆ«å

## æ–‡æ¡£å®Œæ•´æ€§

### ç”¨æˆ·æ–‡æ¡£
- âœ… Makefile ä½¿ç”¨æŒ‡å—
- âœ… è„šæœ¬è¿ç§»è¯´æ˜
- âœ… README æ›´æ–°

### å¼€å‘æ–‡æ¡£
- âœ… Makefile å®ç°æ€»ç»“
- âœ… å‘½ä»¤å¯¹ç…§è¡¨
- âœ… è¿ç§»æ—¶é—´çº¿

### ç¤ºä¾‹æ–‡æ¡£
- âœ… å¿«é€Ÿå¼€å§‹ç¤ºä¾‹
- âœ… å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹
- âœ… å‘å¸ƒæµç¨‹ç¤ºä¾‹

## å‘åå…¼å®¹

### Shell è„šæœ¬ä¿ç•™
- âœ… æ‰€æœ‰åŸè„šæœ¬ä¿ç•™åœ¨ `sh/` ç›®å½•
- âœ… å¯ä»¥ç»§ç»­ä½¿ç”¨åŸè„šæœ¬
- âœ… é€æ­¥è¿ç§»åˆ° Makefile

### è¿ç§»ç­–ç•¥
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼ˆå½“å‰ï¼‰
   - Makefile å’Œ shell è„šæœ¬å¹¶å­˜
   - é¼“åŠ±ä½¿ç”¨ Makefile

2. **ç¬¬äºŒé˜¶æ®µ**ï¼ˆ1-2 ä¸ªæœˆåï¼‰
   - ä¸»è¦ä½¿ç”¨ Makefile
   - shell è„šæœ¬æ ‡è®°ä¸ºåºŸå¼ƒ

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼ˆ3-6 ä¸ªæœˆåï¼‰
   - ç§»é™¤ shell è„šæœ¬
   - åªä¿ç•™ Makefile

## åç»­ä¼˜åŒ–

### åŠŸèƒ½å¢å¼º
1. ğŸ”® æ·»åŠ å‘½ä»¤åˆ«å
2. ğŸ”® æ”¯æŒæ›´å¤šå‚æ•°
3. ğŸ”® æ·»åŠ äº¤äº’å¼å‘½ä»¤
4. ğŸ”® æ”¯æŒé…ç½®æ–‡ä»¶

### æ–‡æ¡£æ”¹è¿›
1. ğŸ”® æ·»åŠ è§†é¢‘æ•™ç¨‹
2. ğŸ”® æ·»åŠ æ›´å¤šç¤ºä¾‹
3. ğŸ”® ç¿»è¯‘æˆè‹±æ–‡

### å·¥å…·é›†æˆ
1. ğŸ”® é›†æˆåˆ° VS Code ä»»åŠ¡
2. ğŸ”® é›†æˆåˆ° Git hooks
3. ğŸ”® é›†æˆåˆ° CI/CD

## ç»Ÿè®¡æ•°æ®

### ä»£ç é‡
- Makefile: ~300 è¡Œ
- æ–‡æ¡£: ~1500 è¡Œ
- æ€»è®¡: ~1800 è¡Œ

### å‘½ä»¤æ•°é‡
- å¼€å‘å‘½ä»¤: 4 ä¸ª
- æµ‹è¯•å‘½ä»¤: 5 ä¸ª
- æ„å»ºå‘½ä»¤: 3 ä¸ª
- å‘å¸ƒå‘½ä»¤: 2 ä¸ª
- ç»´æŠ¤å‘½ä»¤: 8 ä¸ª
- å¸®åŠ©å‘½ä»¤: 1 ä¸ª
- **æ€»è®¡**: 23 ä¸ªå‘½ä»¤

### è„šæœ¬è¿ç§»
- è¿ç§»è„šæœ¬: 9 ä¸ª
- ä¿ç•™è„šæœ¬: 1 ä¸ª
- è¿ç§»ç‡: 90%

## æ€»ç»“

### æˆæœ
1. âœ… æˆåŠŸåˆ›å»º Makefile
2. âœ… è¿ç§»æ‰€æœ‰ä¸»è¦è„šæœ¬
3. âœ… å®Œå–„æ–‡æ¡£ç³»ç»Ÿ
4. âœ… æ›´æ–° README
5. âœ… æµ‹è¯•éªŒè¯é€šè¿‡

### ä¼˜åŠ¿
1. âœ… å‘½ä»¤æ›´ç®€æ´ï¼ˆå‡å°‘ 60% å­—ç¬¦ï¼‰
2. âœ… è·¨å¹³å°å…¼å®¹æ€§å¥½
3. âœ… è‡ªåŠ¨ä¾èµ–ç®¡ç†
4. âœ… ç»Ÿä¸€çš„æ¥å£
5. âœ… å®Œå–„çš„å¸®åŠ©ç³»ç»Ÿ

### å½±å“
1. âœ… æå‡å¼€å‘æ•ˆç‡
2. âœ… é™ä½å­¦ä¹ æˆæœ¬
3. âœ… æ”¹å–„ç”¨æˆ·ä½“éªŒ
4. âœ… ä¾¿äºç»´æŠ¤

### ä¸‹ä¸€æ­¥
1. æ¨å¹¿ä½¿ç”¨ Makefile
2. æ”¶é›†ç”¨æˆ·åé¦ˆ
3. æŒç»­ä¼˜åŒ–æ”¹è¿›
4. é€æ­¥åºŸå¼ƒ shell è„šæœ¬

---

**å®ç°æ—¶é—´**: çº¦ 2 å°æ—¶  
**ä»£ç è´¨é‡**: â­â­â­â­â­  
**æ–‡æ¡£å®Œæ•´åº¦**: â­â­â­â­â­  
**ç”¨æˆ·ä½“éªŒ**: â­â­â­â­â­

**ç»“è®º**: Makefile è¿ç§»æˆåŠŸï¼Œæ˜¾è‘—æå‡äº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒï¼
