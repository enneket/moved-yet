# 紧急修复指南 - 无法关闭的通知问题

## 🚨 问题描述

如果你遇到了两个橙色的"温馨提示"通知无法关闭的问题，这是渐进式提醒功能的已知问题。

## 🔧 立即解决方案

### 方法1: 使用紧急修复命令（推荐）
1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入：`动了么？: 清理所有提醒（紧急修复）`
3. 执行命令，所有提醒将被清理

### 方法2: 重启VS Code
1. 保存所有工作
2. 完全关闭VS Code
3. 重新打开VS Code

### 方法3: 禁用渐进式提醒
1. 打开设置 (`Ctrl+,`)
2. 搜索 `movedYet.enableProgressiveReminder`
3. 取消勾选此选项
4. 执行紧急修复命令

## 🛠️ 已修复的问题

### v0.0.2 修复内容
- ✅ 添加了活跃状态跟踪，防止重复提醒
- ✅ 改进了通知状态管理
- ✅ 添加了详细的日志记录
- ✅ 增加了紧急修复命令
- ✅ 优化了提醒停止逻辑

### 修复的具体问题
1. **重复通知**: 现在会检查是否已有活跃提醒
2. **状态混乱**: 添加了 `isActive` 标记跟踪状态
3. **通知泄漏**: 改进了通知引用管理
4. **无法清理**: 提供了紧急修复命令

## 🔍 问题原因分析

### 原始问题
- 多个提醒同时触发导致重复通知
- VS Code的 `showWarningMessage` 无法被程序主动取消
- 渐进式提醒状态管理不完善
- 缺少紧急清理机制

### 技术细节
```typescript
// 问题代码（已修复）
vscode.window.showWarningMessage(...).then(selection => {
    // 如果有多个提醒，会创建多个无法取消的通知
});

// 修复后的代码
if (this.isActive) {
    this.stopProgressiveReminder(); // 先停止现有提醒
}
this.isActive = true; // 标记为活跃状态
```

## 📋 预防措施

### 推荐配置
```json
{
    // 如果经常遇到问题，可以禁用渐进式提醒
    "movedYet.enableProgressiveReminder": false,
    
    // 或者调整提醒间隔，减少触发频率
    "movedYet.sitReminderInterval": 90,
    "movedYet.drinkReminderInterval": 60
}
```

### 使用建议
1. **避免频繁重置**: 不要频繁使用重置计时器命令
2. **合理配置间隔**: 设置合适的提醒间隔时间
3. **及时处理提醒**: 看到提醒时及时处理，不要让它升级

## 🎯 新功能说明

### 紧急修复命令
- **命令**: `动了么？: 清理所有提醒（紧急修复）`
- **功能**: 立即停止所有活跃的提醒和计时器
- **使用场景**: 遇到无法关闭的通知时

### 改进的日志
现在会在控制台输出详细日志：
```
开始渐进式提醒: sit, 第1级持续5分钟
升级到第2级提醒: sit
用户确认提醒
停止渐进式提醒
```

## 🔄 更新说明

### 如何更新到修复版本
1. 卸载当前版本
2. 安装新的 `moved-yet-0.0.2.vsix`
3. 重启VS Code

### 验证修复
1. 启用渐进式提醒
2. 等待提醒触发
3. 检查是否只有一个通知
4. 测试紧急修复命令

## 📞 反馈渠道

如果问题仍然存在：
1. 查看VS Code开发者工具控制台的日志
2. 记录问题复现步骤
3. 提交详细的问题报告

---

**🎯 目标**: 确保所有用户都能正常使用提醒功能，不再遇到无法关闭的通知问题！